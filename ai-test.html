<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæµ‹è¯• - æŠ€èƒ½äº”å­æ£‹</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 5px;
        }
        .test-result { 
            margin: 10px 0; 
            padding: 10px;
            border-radius: 5px;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button { 
            margin: 5px; 
            padding: 10px 15px; 
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover {
            background: #0056b3;
        }
        .board-display {
            font-family: monospace;
            font-size: 12px;
            line-height: 1.2;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .difficulty-selector {
            margin: 10px 0;
        }
        .difficulty-selector select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¤– AIæ™ºèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>AIéš¾åº¦è®¾ç½®</h2>
            <div class="difficulty-selector">
                <label>é€‰æ‹©AIéš¾åº¦ï¼š</label>
                <select id="difficulty-select">
                    <option value="easy">ç®€å• - AIä¼šçŠ¯é”™ï¼Œé˜²å®ˆè¾ƒå¼±</option>
                    <option value="normal" selected>æ™®é€š - å¹³è¡¡çš„æ”»é˜²</option>
                    <option value="hard">å›°éš¾ - å¼ºåŠ›é˜²å®ˆå’Œæ”»å‡»</option>
                </select>
                <button onclick="updateAIDifficulty()">åº”ç”¨è®¾ç½®</button>
            </div>
            <div id="difficulty-result" class="test-result info" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h2>é˜²å®ˆèƒ½åŠ›æµ‹è¯•</h2>
            <p>æµ‹è¯•AIæ˜¯å¦èƒ½è¯†åˆ«å¹¶é˜»æ­¢ç©å®¶çš„è·èƒœå¨èƒ</p>
            <button onclick="testDefense()">æµ‹è¯•é˜²å®ˆèƒ½åŠ›</button>
            <div id="defense-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>æ”»å‡»èƒ½åŠ›æµ‹è¯•</h2>
            <p>æµ‹è¯•AIæ˜¯å¦èƒ½è¯†åˆ«å¹¶åˆ©ç”¨æ”»å‡»æœºä¼š</p>
            <button onclick="testAttack()">æµ‹è¯•æ”»å‡»èƒ½åŠ›</button>
            <div id="attack-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>å®æ—¶å¯¹æˆ˜æµ‹è¯•</h2>
            <p>ä¸AIè¿›è¡Œå®æ—¶å¯¹æˆ˜ï¼Œè§‚å¯Ÿå…¶è¡¨ç°</p>
            <button onclick="startRealTimeTest()">å¼€å§‹å¯¹æˆ˜æµ‹è¯•</button>
            <div id="realtime-test"></div>
        </div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„è„šæœ¬ -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/SmartAI.js"></script>
    
    <script>
        function log(message, isError = false, containerId = 'test-results') {
            console.log(message);
            const container = document.getElementById(containerId);
            if (container) {
                const div = document.createElement('div');
                div.className = `test-result ${isError ? 'error' : 'success'}`;
                div.textContent = message;
                container.appendChild(div);
            }
        }

        function updateAIDifficulty() {
            const difficulty = document.getElementById('difficulty-select').value;
            if (window.smartAI) {
                window.smartAI.setDifficulty(difficulty);
                const resultDiv = document.getElementById('difficulty-result');
                resultDiv.style.display = 'block';
                resultDiv.textContent = `AIéš¾åº¦å·²è®¾ç½®ä¸º: ${difficulty}`;
                log(`AIéš¾åº¦å·²æ›´æ–°ä¸º: ${difficulty}`, false, 'difficulty-result');
            }
        }

        function createTestBoard() {
            // åˆ›å»º15x15çš„ç©ºæ£‹ç›˜
            const board = [];
            for (let i = 0; i < 15; i++) {
                board[i] = [];
                for (let j = 0; j < 15; j++) {
                    board[i][j] = 0;
                }
            }
            return board;
        }

        function displayBoard(board, title = '') {
            let display = title ? `${title}\n` : '';
            display += '   ';
            for (let i = 0; i < 15; i++) {
                display += i.toString().padStart(2, ' ');
            }
            display += '\n';

            for (let x = 0; x < 15; x++) {
                display += x.toString().padStart(2, ' ') + ' ';
                for (let y = 0; y < 15; y++) {
                    const piece = board[x][y];
                    const symbol = piece === 0 ? 'Â·' : (piece === 1 ? 'â—' : 'â—‹');
                    display += symbol.padStart(2, ' ');
                }
                display += '\n';
            }
            return display;
        }

        function testDefense() {
            const container = document.getElementById('defense-tests');
            container.innerHTML = '<h3>é˜²å®ˆæµ‹è¯•ç»“æœï¼š</h3>';

            // æµ‹è¯•åœºæ™¯1ï¼šé˜»æ­¢ç©å®¶å››è¿è·èƒœ
            const board1 = createTestBoard();
            // ç©å®¶æœ‰å››è¿ï¼ŒAIéœ€è¦é˜»æ­¢
            board1[7][5] = 1; // ç©å®¶
            board1[7][6] = 1; // ç©å®¶
            board1[7][7] = 1; // ç©å®¶
            board1[7][8] = 1; // ç©å®¶
            // ä½ç½®[7][9]å’Œ[7][4]æ˜¯å…³é”®é˜²å®ˆç‚¹

            const move1 = window.smartAI.getBestMove(board1, 2, 1);
            const isDefenseCorrect1 = (move1.x === 7 && (move1.y === 4 || move1.y === 9));
            
            const boardDisplay1 = document.createElement('div');
            boardDisplay1.className = 'board-display';
            boardDisplay1.textContent = displayBoard(board1, 'æµ‹è¯•1: é˜»æ­¢ç©å®¶å››è¿è·èƒœ');
            container.appendChild(boardDisplay1);

            log(`æµ‹è¯•1 - AIé€‰æ‹©: (${move1.x}, ${move1.y}) ç†ç”±: ${move1.reasoning}`, !isDefenseCorrect1, 'defense-tests');
            log(`æµ‹è¯•1ç»“æœ: ${isDefenseCorrect1 ? 'âœ… æ­£ç¡®é˜²å®ˆ' : 'âŒ é˜²å®ˆå¤±è´¥'}`, !isDefenseCorrect1, 'defense-tests');

            // æµ‹è¯•åœºæ™¯2ï¼šé˜»æ­¢ç©å®¶ä¸‰è¿å¨èƒ
            const board2 = createTestBoard();
            board2[8][6] = 1; // ç©å®¶
            board2[8][7] = 1; // ç©å®¶
            board2[8][8] = 1; // ç©å®¶
            // éœ€è¦é˜²å®ˆ[8][5]æˆ–[8][9]

            const move2 = window.smartAI.getBestMove(board2, 2, 1);
            const isDefenseCorrect2 = (move2.x === 8 && (move2.y === 5 || move2.y === 9));

            const boardDisplay2 = document.createElement('div');
            boardDisplay2.className = 'board-display';
            boardDisplay2.textContent = displayBoard(board2, 'æµ‹è¯•2: é˜»æ­¢ç©å®¶ä¸‰è¿å¨èƒ');
            container.appendChild(boardDisplay2);

            log(`æµ‹è¯•2 - AIé€‰æ‹©: (${move2.x}, ${move2.y}) ç†ç”±: ${move2.reasoning}`, !isDefenseCorrect2, 'defense-tests');
            log(`æµ‹è¯•2ç»“æœ: ${isDefenseCorrect2 ? 'âœ… æ­£ç¡®é˜²å®ˆ' : 'âŒ é˜²å®ˆå¤±è´¥'}`, !isDefenseCorrect2, 'defense-tests');
        }

        function testAttack() {
            const container = document.getElementById('attack-tests');
            container.innerHTML = '<h3>æ”»å‡»æµ‹è¯•ç»“æœï¼š</h3>';

            // æµ‹è¯•åœºæ™¯1ï¼šAIèƒ½ç›´æ¥è·èƒœ
            const board1 = createTestBoard();
            board1[7][5] = 2; // AI
            board1[7][6] = 2; // AI
            board1[7][7] = 2; // AI
            board1[7][8] = 2; // AI
            // AIåº”è¯¥é€‰æ‹©[7][4]æˆ–[7][9]è·èƒœ

            const move1 = window.smartAI.getBestMove(board1, 2, 1);
            const isAttackCorrect1 = (move1.x === 7 && (move1.y === 4 || move1.y === 9));

            const boardDisplay1 = document.createElement('div');
            boardDisplay1.className = 'board-display';
            boardDisplay1.textContent = displayBoard(board1, 'æµ‹è¯•1: AIç›´æ¥è·èƒœæœºä¼š');
            container.appendChild(boardDisplay1);

            log(`æµ‹è¯•1 - AIé€‰æ‹©: (${move1.x}, ${move1.y}) ç†ç”±: ${move1.reasoning}`, !isAttackCorrect1, 'attack-tests');
            log(`æµ‹è¯•1ç»“æœ: ${isAttackCorrect1 ? 'âœ… æ­£ç¡®æ”»å‡»' : 'âŒ æ”»å‡»å¤±è´¥'}`, !isAttackCorrect1, 'attack-tests');

            // æµ‹è¯•åœºæ™¯2ï¼šAIå½¢æˆå››è¿å¨èƒ
            const board2 = createTestBoard();
            board2[8][6] = 2; // AI
            board2[8][7] = 2; // AI
            board2[8][8] = 2; // AI
            // AIåº”è¯¥é€‰æ‹©[8][5]æˆ–[8][9]å½¢æˆå››è¿

            const move2 = window.smartAI.getBestMove(board2, 2, 1);
            const isAttackCorrect2 = (move2.x === 8 && (move2.y === 5 || move2.y === 9));

            const boardDisplay2 = document.createElement('div');
            boardDisplay2.className = 'board-display';
            boardDisplay2.textContent = displayBoard(board2, 'æµ‹è¯•2: AIå½¢æˆå››è¿å¨èƒ');
            container.appendChild(boardDisplay2);

            log(`æµ‹è¯•2 - AIé€‰æ‹©: (${move2.x}, ${move2.y}) ç†ç”±: ${move2.reasoning}`, !isAttackCorrect2, 'attack-tests');
            log(`æµ‹è¯•2ç»“æœ: ${isAttackCorrect2 ? 'âœ… æ­£ç¡®æ”»å‡»' : 'âŒ æ”»å‡»å¤±è´¥'}`, !isAttackCorrect2, 'attack-tests');
        }

        function startRealTimeTest() {
            const container = document.getElementById('realtime-test');
            container.innerHTML = '<h3>å®æ—¶å¯¹æˆ˜æµ‹è¯•ï¼š</h3>';
            
            const board = createTestBoard();
            let currentPlayer = 1; // ç©å®¶å…ˆæ‰‹
            let moveCount = 0;

            function makeMove(x, y) {
                if (board[x][y] !== 0) return false;
                
                board[x][y] = currentPlayer;
                moveCount++;
                
                // æ˜¾ç¤ºæ£‹ç›˜
                const boardDisplay = document.createElement('div');
                boardDisplay.className = 'board-display';
                boardDisplay.textContent = displayBoard(board, `ç¬¬${moveCount}æ­¥ - ${currentPlayer === 1 ? 'ç©å®¶' : 'AI'}è½å­(${x}, ${y})`);
                container.appendChild(boardDisplay);
                
                // æ£€æŸ¥è·èƒœ
                if (checkWin(board, x, y, currentPlayer)) {
                    log(`æ¸¸æˆç»“æŸï¼${currentPlayer === 1 ? 'ç©å®¶' : 'AI'}è·èƒœï¼`, false, 'realtime-test');
                    return true;
                }
                
                // åˆ‡æ¢ç©å®¶
                currentPlayer = currentPlayer === 1 ? 2 : 1;
                
                // å¦‚æœæ˜¯AIå›åˆ
                if (currentPlayer === 2) {
                    setTimeout(() => {
                        const aiMove = window.smartAI.getBestMove(board, 2, 1);
                        if (aiMove) {
                            log(`AIæ€è€ƒç»“æœ: (${aiMove.x}, ${aiMove.y}) - ${aiMove.reasoning}`, false, 'realtime-test');
                            makeMove(aiMove.x, aiMove.y);
                        }
                    }, 500);
                }
                
                return false;
            }

            // åˆ›å»ºäº¤äº’ç•Œé¢
            const controlDiv = document.createElement('div');
            controlDiv.innerHTML = `
                <p>ç‚¹å‡»åæ ‡è¿›è¡Œè½å­ï¼ˆç©å®¶å…ˆæ‰‹ï¼‰ï¼š</p>
                <input type="number" id="move-x" placeholder="Xåæ ‡(0-14)" min="0" max="14" style="width:120px;">
                <input type="number" id="move-y" placeholder="Yåæ ‡(0-14)" min="0" max="14" style="width:120px;">
                <button onclick="makePlayerMove()">è½å­</button>
                <button onclick="startRealTimeTest()">é‡æ–°å¼€å§‹</button>
            `;
            container.appendChild(controlDiv);

            // æ˜¾ç¤ºåˆå§‹æ£‹ç›˜
            const initialBoard = document.createElement('div');
            initialBoard.className = 'board-display';
            initialBoard.textContent = displayBoard(board, 'åˆå§‹æ£‹ç›˜ - ç©å®¶å…ˆæ‰‹');
            container.appendChild(initialBoard);

            // å…¨å±€å‡½æ•°ä¾›æŒ‰é’®è°ƒç”¨
            window.makePlayerMove = function() {
                const x = parseInt(document.getElementById('move-x').value);
                const y = parseInt(document.getElementById('move-y').value);
                
                if (isNaN(x) || isNaN(y) || x < 0 || x > 14 || y < 0 || y > 14) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„åæ ‡ (0-14)');
                    return;
                }
                
                if (currentPlayer !== 1) {
                    alert('è¯·ç­‰å¾…AIè¡ŒåŠ¨');
                    return;
                }
                
                if (board[x][y] !== 0) {
                    alert('è¯¥ä½ç½®å·²æœ‰æ£‹å­');
                    return;
                }
                
                makeMove(x, y);
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('move-x').value = '';
                document.getElementById('move-y').value = '';
            };
        }

        function checkWin(board, x, y, player) {
            const directions = [[0,1], [1,0], [1,1], [1,-1]];
            
            for (const [dx, dy] of directions) {
                let count = 1;
                
                // æ­£æ–¹å‘
                for (let i = 1; i < 5; i++) {
                    const nx = x + dx * i;
                    const ny = y + dy * i;
                    if (nx >= 0 && nx < 15 && ny >= 0 && ny < 15 && board[nx][ny] === player) {
                        count++;
                    } else break;
                }
                
                // è´Ÿæ–¹å‘
                for (let i = 1; i < 5; i++) {
                    const nx = x - dx * i;
                    const ny = y - dy * i;
                    if (nx >= 0 && nx < 15 && ny >= 0 && ny < 15 && board[nx][ny] === player) {
                        count++;
                    } else break;
                }
                
                if (count >= 5) return true;
            }
            
            return false;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('AIæµ‹è¯•é¡µé¢å·²åŠ è½½');
            if (window.smartAI) {
                log('âœ… æ™ºèƒ½AIç³»ç»Ÿå·²åŠ è½½', false, 'difficulty-result');
                document.getElementById('difficulty-result').style.display = 'block';
            } else {
                log('âŒ æ™ºèƒ½AIç³»ç»ŸåŠ è½½å¤±è´¥', true, 'difficulty-result');
                document.getElementById('difficulty-result').style.display = 'block';
            }
        });
    </script>
</body>
</html>
